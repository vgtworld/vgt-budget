<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
		xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

	<changeSet id="1.0-create-table-stores" author="VGT">
		<createTable tableName="stores">
			<column name="id" type="int" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="name" type="varchar(100)">
				<constraints nullable="false"/>
			</column>
			<column name="city" type="varchar(50)">
				<constraints nullable="false"/>
			</column>
			<column name="address" type="varchar(200)">
				<constraints nullable="false"/>
			</column>
			<column name="created_at" type="datetime">
				<constraints nullable="false"/>
			</column>
			<column name="deleted" type="boolean">
				<constraints nullable="false"/>
			</column>
		</createTable>
	</changeSet>

	<changeSet id="1.0-create-table-products" author="VGT">
		<createTable tableName="products">
			<column name="id" type="int" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="name" type="varchar(100)">
				<constraints nullable="false" unique="true"/>
			</column>
		</createTable>
	</changeSet>

	<changeSet id="1.0-create-table-tags" author="VGT">
		<createTable tableName="tags">
			<column name="id" type="int" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="name" type="varchar(100)">
				<constraints nullable="false" unique="true"/>
			</column>
		</createTable>
	</changeSet>

	<changeSet id="1.0-create-table-product_tags" author="VGT">
		<createTable tableName="product_tags">
			<column name="product_id" type="int">
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="tag_id" type="int">
				<constraints nullable="false" primaryKey="true"/>
			</column>
		</createTable>
		<addForeignKeyConstraint
				constraintName="fk_products_product_tags"
				baseTableName="products"
				baseColumnNames="id"
				referencedTableName="product_tags"
				referencedColumnNames="product_id"
				onUpdate="CASCADE"
				onDelete="CASCADE"
				/>
		<addForeignKeyConstraint
				constraintName="fk_tags_product_tags"
				baseTableName="tags"
				baseColumnNames="id"
				referencedTableName="product_tags"
				referencedColumnNames="tag_id"
				onUpdate="CASCADE"
				onDelete="RESTRICT"
				/>
	</changeSet>

</databaseChangeLog>
